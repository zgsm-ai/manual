name: Check Chinese Content in Docs

on:
  push:
    branches:
      - 'main'
      - 'master'
    paths:
      - 'docs/**'
  pull_request:
    branches:
      - 'main'
      - 'master'
    paths:
      - 'docs/**'

jobs:
  check-chinese:
    name: Check for Chinese Characters
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Check Chinese Content
        run: |
          # åˆ›å»ºæ£€æŸ¥è„šæœ¬
          cat > check_chinese.js << 'EOF'
          const fs = require('fs');
          const path = require('path');
          
          // é€’å½’æŸ¥æ‰¾æ‰€æœ‰.mdå’Œ.jsonæ–‡ä»¶
          function findFiles(dir, extensions) {
            let results = [];
            const files = fs.readdirSync(dir);
            
            for (const file of files) {
              const filePath = path.join(dir, file);
              const stat = fs.statSync(filePath);
              
              if (stat.isDirectory()) {
                results = results.concat(findFiles(filePath, extensions));
              } else if (extensions.some(ext => file.endsWith(ext))) {
                results.push(filePath);
              }
            }
            
            return results;
          }
          
          // æ£€æŸ¥æ–‡ä»¶ä¸­çš„ä¸­æ–‡å­—ç¬¦
          function checkChinese(filePath) {
            const content = fs.readFileSync(filePath, 'utf8');
            const lines = content.split('\n');
            const chineseRegex = /[\u4e00-\u9fff]/;
            const results = [];
            
            lines.forEach((line, index) => {
              if (chineseRegex.test(line)) {
                results.push({
                  lineNumber: index + 1,
                  content: line.trim(),
                  matches: line.match(chineseRegex)
                });
              }
            });
            
            return results;
          }
          
          // ä¸»å‡½æ•°
          function main() {
            const docsDir = './docs';
            const files = findFiles(docsDir, ['.md', '.json']);
            let hasChinese = false;
            
            console.log(`æ£€æŸ¥ ${files.length} ä¸ªæ–‡ä»¶...`);
            
            for (const file of files) {
              const chineseLines = checkChinese(file);
              
              if (chineseLines.length > 0) {
                hasChinese = true;
                console.error(`\nâŒ æ–‡ä»¶ "${file}" åŒ…å«ä¸­æ–‡å­—ç¬¦:`);
                
                chineseLines.forEach(line => {
                  console.error(`  è¡Œ ${line.lineNumber}: ${line.content}`);
                });
              }
            }
            
            if (hasChinese) {
              console.error('\nğŸš¨ å‘ç°ä¸­æ–‡å­—ç¬¦ï¼docsæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ä¸åº”åŒ…å«ä¸­æ–‡å†…å®¹ã€‚');
              console.error('è¯·å°†ä¸­æ–‡å†…å®¹ç§»è‡³ i18n/zh/docusaurus-plugin-content-docs/current/ ç›®å½•ä¸‹å¯¹åº”çš„æ–‡ä»¶ä¸­ã€‚');
              process.exit(1);
            } else {
              console.log('\nâœ… æ‰€æœ‰æ–‡ä»¶æ£€æŸ¥é€šè¿‡ï¼Œæœªå‘ç°ä¸­æ–‡å­—ç¬¦ã€‚');
            }
          }
          
          main();
          EOF
          
          # è¿è¡Œæ£€æŸ¥è„šæœ¬
          node check_chinese.js